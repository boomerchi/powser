#!/usr/bin/ruby

require 'rubygems'
require 'thor'
require 'fileutils'
require 'net/https'
require 'powser/version'
require 'powder'

module Powser
  class CLI < Thor
    include Thor::Actions
    default_task :help
    
    SERVER_PATH = File.dirname(__FILE__) + "/../lib/powser"

    desc "start", "Start a webserver to provide powder functionality from your browser. The server is located at http://powser.dev. Pass the name of the pow link that you want powser to monitor."
    def start(app = nil)
      return unless is_powable?
      app ||= get_pow_name
      Dir.chdir(SERVER_PATH) do
        `powder link powser`
        File.open("app", "w") do |f|
          f.puts(app)
        end
        say "Powser defaults to #{app}."
      end
    end

    desc "stop", "Kill the powser server."
    def stop(app = nil)
      app ||= get_pow_name
      Dir.chdir(SERVER_PATH) do
        `powder unlink`
        say "Powser no longer defaults to #{app}."
      end
    end

    desc "restart", "Restart the powser server."
    def restart
      Dir.chdir(SERVER_PATH) do
        `powder restart`
        say "Powser will restart."
      end
    end

    desc "version", "Shows the version."
    def version
       say "powser #{Powser::VERSION}"
    end

    private
    include Powder::Helpers
    
  end
end
Powser::CLI.start
